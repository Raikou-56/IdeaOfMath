@{
    ViewData["Title"] = "My Page";
}
@section Styles {
    <link rel="stylesheet" href="~/css/mypage.css" />
}
@section Scripts {
    <script src="~/js/mypage.js"></script>
}
@using MathSiteProject.Extentions;

@model UserViewModel

<div class="user-profile">
    <div class="profile-section">
        <div class="profile-card">
            <h2><i class="fas fa-user-circle"></i> プロフィール</h2>
            <ul class="profile-list">
                <li><i class="fas fa-id-badge"></i> <strong>ユーザーID:</strong> @Model.UserId</li>
                <li><i class="fas fa-user"></i> <strong>ユーザー名:</strong> @Model.UserName</li>
                <li><i class="fas fa-user-tag"></i> <strong>ロール:</strong> @Model.Role</li>
                <li><i class="fas fa-graduation-cap"></i> <strong>学年:</strong> @(Model.Grade ?? "<span class='text-muted'>学年が選択されていません</span>")</li>
            </ul>
            <button id="editBtn" class="send">
                <svg class="gear-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="10" stroke="black" stroke-width="2" fill="none"/>
                    <line x1="12" y1="6" x2="12" y2="18" stroke="black" stroke-width="2"/>
                    <line x1="6" y1="12" x2="18" y2="12" stroke="black" stroke-width="2"/>
                </svg>
                プロフィールを編集
            </button>
            <div id="editForm" class="update-form">
                <form asp-controller="Account" asp-action="UpdateProfile" method="post">
                    <input type="hidden" name="UserId" value="@Model.UserId" />
                    <div class="form-group">
                        <label for="UserName">ユーザー名</label>
                        <input type="text" id="UserName" name="UserName" value="@Model.UserName" class="form-control" />
                        <br />
                        <label for="Grade">学年</label>
                        <select asp-for="Grade" asp-items="Model.GradeOptions" class="form-control modern-control">
                            <option value="">選択してください</option>
                        </select>
                    </div>
                    <button type="submit" class="send">更新</button>
                </form>
            </div>
        </div>
        <!-- 編集フォーム -->
        
        <br />

        <div class="user-rank">
            <img src="@ScoreExtensions.GetBadgeImage(Model.TotalScores)" alt="ランクバッジ" class="rank-badge" />
            <div class="score-display @ScoreExtensions.GetScoreColorClass(Model.TotalScores)">
                累計：@Model.TotalScores 点
            </div>
        </div>
    </div>

    @if (Model.IntsAnsweredbyDifficulty != null && Model.IntsAnsweredbyDifficulty.Length == 5)
    {
        <h3>成績</h3>
        <div class="difficulty-cards">
            @for (int i = 0; i < 5; i++)
            {
                var label = ((char)('A' + i)).ToString(); // A〜E
                var answered = Model.IntsAnsweredbyDifficulty[i];
                var totalScore = Model.ScoresbyDifficulty?[i] ?? 0;
                var averageScore = Model.AverageScoresbyDifficulty?[i] != null 
                    ? Model.AverageScoresbyDifficulty[i].ToString("0.00") 
                    : "0.00";

    
                <div class="field-card difficulty-card">
                    <h4>難易度 @label</h4>
                    <p>解答数：<span class="count">@answered</span></p>
                    <p>合計点：<span class="count">@totalScore</span></p>
                    <p>平均点：<span class="count">@averageScore</span></p>
                </div>
            }
        </div>
    }

    else
    {
        <p>難易度別の統計情報はまだありません。</p>
    }
</div>

